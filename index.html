<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MadhavVideos</title>
  <style>
    :root{--bg:#0f0f0f;--panel:#181818;--panel2:#1f1f1f;--text:#f1f1f1;--muted:#aaaaaa;--border:#2a2a2a;--chip:#272727;--chipActive:#3f3f3f;--shadow:0 12px 40px rgba(0,0,0,.45)}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
    @media (max-width:920px){.app{grid-template-columns:1fr}.sidebar{display:none}}
    .topbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 14px;background:rgba(15,15,15,.94);border-bottom:1px solid var(--border);backdrop-filter:blur(10px)}
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#ff3d3d,#ff8a00);display:grid;place-items:center;font-weight:900}
    .brandTitle{font-weight:800;letter-spacing:.2px}
    .searchWrap{flex:1;display:flex;justify-content:center}
    .search{width:min(720px,100%);display:flex;align-items:center;background:#121212;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .search input{flex:1;padding:10px 14px;border:none;outline:none;background:transparent;color:var(--text);font-size:14px}
    .search button{border:none;background:var(--panel2);color:var(--text);padding:10px 14px;cursor:pointer}
    .rightActions{display:flex;align-items:center;gap:10px;min-width:220px;justify-content:flex-end}
    .iconBtn{border:1px solid var(--border);background:var(--panel2);color:var(--text);padding:8px 10px;border-radius:999px;cursor:pointer;font-size:13px}
    .iconBtn:hover{background:#262626}
    .sidebar{position:sticky;top:0;height:100vh;border-right:1px solid var(--border);background:var(--bg);padding:12px 10px}
    .navTitle{color:var(--muted);font-size:12px;margin:16px 10px 8px}
    .navItem{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;cursor:pointer}
    .navItem:hover{background:#1a1a1a}
    .navItem small{color:var(--muted)}
    .main{padding:14px}
    .introCard{border:1px solid var(--border);background:var(--panel);border-radius:16px;padding:14px;display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
    .introCard h1{margin:0;font-size:18px}
    .introCard p{margin:8px 0 0;color:var(--muted);line-height:1.45}
    .chips{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;position:sticky;top:58px;z-index:20;padding:10px 0;background:linear-gradient(to bottom,rgba(15,15,15,.95),rgba(15,15,15,.75),rgba(15,15,15,0));backdrop-filter:blur(10px)}
    .chip{border:1px solid var(--border);background:var(--chip);padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer;user-select:none}
    .chip:hover{background:#2f2f2f}
    .chip.active{background:var(--chipActive)}
    .grid{margin-top:10px;display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media (max-width:1200px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:540px){.grid{grid-template-columns:1fr}}
    .videoCard{cursor:pointer}
    .thumb{width:100%;aspect-ratio:16/9;border-radius:14px;overflow:hidden;border:1px solid var(--border);background:#101010;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .duration{position:absolute;right:8px;bottom:8px;background:rgba(0,0,0,.75);padding:2px 6px;border-radius:6px;font-size:12px}
    .meta{display:flex;gap:10px;margin-top:10px}
    .avatar{width:36px;height:36px;border-radius:999px;background:linear-gradient(135deg,#3aa0ff,#9b59ff);display:grid;place-items:center;font-weight:900;font-size:12px;flex:0 0 auto}
    .meta h3{margin:0;font-size:14px;line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .meta .sub{margin-top:6px;color:var(--muted);font-size:12px}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:18px;z-index:100}
    .modal{width:min(980px,100%);background:#121212;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
    .modalTop{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#141414;border-bottom:1px solid var(--border);gap:12px}
    .close{cursor:pointer;border:1px solid var(--border);background:#1f1f1f;padding:6px 10px;border-radius:999px}
    .playerWrap{position:relative;padding-top:56.25%}
    .playerWrap iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
    .modalBody{padding:12px}
    .modalBody p{margin:8px 0 0;color:var(--muted);white-space:pre-wrap}
    .sheet{width:min(720px,100%);background:#121212;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:14px}
    .sheet h2{margin:0;font-size:16px}
    .field{margin-top:10px;display:grid;gap:8px}
    input,textarea{width:100%;border:1px solid var(--border);background:#0f0f0f;color:var(--text);border-radius:12px;padding:10px 12px;outline:none}
    textarea{min-height:110px;resize:vertical}
    .err{display:none;color:#ffb4b4;font-size:12px;margin-top:6px}
    .row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .primary{border:none;background:#ff3d3d;color:#111;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:800}
    .secondary{border:1px solid var(--border);background:#1f1f1f;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    .smallNote{margin-top:10px;color:var(--muted);font-size:12px}
    pre{background:#0b0b0b;border:1px solid var(--border);padding:10px;border-radius:12px;overflow:auto;max-height:280px}
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar">
      <div class="navItem" onclick="setCategory('All')"><div>üè†</div><div><div style="font-weight:700">Home</div><small>All videos</small></div></div>
      <div class="navTitle">Quick</div>
      <div class="navItem" onclick="openAdminLogin()"><div>üîí</div><div>Admin</div></div>
      <div class="navTitle">About</div>
      <div class="navItem" style="cursor:default;"><div>üë§</div><div><div style="font-weight:700">Madhav</div><small>Video hub</small></div></div>
    </aside>

    <div>
      <header class="topbar">
        <div class="brand">
          <div class="logo">MV</div>
          <div>
            <div class="brandTitle" id="brandName">MadhavVideos</div>
            <div style="color:var(--muted);font-size:12px;">Repo-based videos.json</div>
          </div>
        </div>

        <div class="searchWrap">
          <div class="search">
            <input id="searchInput" placeholder="Search" />
            <button id="searchBtn" title="Search">üîç</button>
          </div>
        </div>

        <div class="rightActions">
          <button class="iconBtn" onclick="openAdminLogin()">Admin</button>
        </div>
      </header>

      <main class="main">
        <div class="introCard">
          <div style="flex:1;min-width:260px;">
            <h1 id="introTitle">Hey! I‚Äôm Madhav üëã</h1>
            <p id="introText">Loading‚Ä¶</p>
          </div>
          <div style="min-width:240px;">
            <div style="color:var(--muted);font-size:12px;">Showing</div>
            <div id="statusLine" style="margin-top:4px;font-weight:800;">0 videos</div>
            <div class="smallNote">Videos are read from <b>videos.json</b> in this repo.</div>
          </div>
        </div>

        <div class="chips" id="chips"></div>
        <div class="grid" id="grid"></div>
      </main>
    </div>
  </div>

  <!-- Player -->
  <div class="overlay" id="playerOverlay">
    <div class="modal">
      <div class="modalTop">
        <strong id="playerTitle">Watch</strong>
        <div class="close" onclick="closeOverlay('playerOverlay')">‚úï</div>
      </div>
      <div class="playerWrap">
        <iframe id="playerFrame" src="" allowfullscreen
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
      </div>
      <div class="modalBody">
        <p id="playerDesc"></p>
      </div>
    </div>
  </div>

  <!-- Admin Login -->
  <div class="overlay" id="loginOverlay">
    <div class="sheet">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
        <h2>Admin Login</h2>
        <div class="close" onclick="closeOverlay('loginOverlay')">‚úï</div>
      </div>
      <div class="field">
        <input id="adminUser" placeholder="Username" />
        <input id="adminPass" type="password" placeholder="Password" />
        <div class="err" id="loginErr">Wrong username/password.</div>
        <div class="row">
          <button class="primary" onclick="submitLogin()">Login</button>
          <button class="secondary" onclick="closeOverlay('loginOverlay')">Cancel</button>
        </div>
        <div class="smallNote">Static-site note: this is convenience-only.</div>
      </div>
    </div>
  </div>

  <!-- Add Video + Export JSON -->
  <div class="overlay" id="addOverlay">
    <div class="sheet">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
        <h2>Add Video (updates JSON)</h2>
        <div class="close" onclick="closeOverlay('addOverlay')">‚úï</div>
      </div>

      <div class="field">
        <input id="vLink" placeholder="YouTube link or video ID" />
        <input id="vTitle" placeholder="Title" />
        <input id="vCategory" placeholder="Category (Java, AWS, AI...)" />
        <textarea id="vDesc" placeholder="Description"></textarea>

        <div class="err" id="addErr">Please provide at least link + category.</div>

        <div class="row">
          <button class="primary" onclick="addVideoToJson()">Generate Updated videos.json</button>
          <button class="secondary" onclick="closeOverlay('addOverlay')">Close</button>
        </div>

        <div id="exportBlock" style="display:none;">
          <div class="smallNote">Copy this and paste into your repo‚Äôs <b>videos.json</b>, then commit.</div>
          <pre id="exportJson"></pre>
          <div class="row">
            <button class="primary" onclick="copyExport()">Copy JSON</button>
            <button class="secondary" onclick="downloadExport()">Download videos.json</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>

  async function sha256(text){
  const buf = new TextEncoder().encode(text);
  const hash = await crypto.subtle.digest("SHA-256", buf);
  return [...new Uint8Array(hash)]
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

let admin = null;   // will be loaded from videos.json
  // =========================
  // CONFIG (change these)
  // =========================
  const ADMIN_USERNAME = "admin";
  const ADMIN_PASSWORD = "1234";
  const DATA_URL = "videos.json"; // repo file

  // loaded from repo
  let channel = { name: "MadhavVideos", intro: "" };
  let videos = [];
  let activeCategory = "All";

  // =========================
  // Helpers
  // =========================
  function extractYouTubeId(input) {
    if (!input) return "";
    const s = input.trim();
    if (/^[a-zA-Z0-9_-]{11}$/.test(s)) return s;
    const patterns = [/v=([a-zA-Z0-9_-]{11})/, /youtu\.be\/([a-zA-Z0-9_-]{11})/, /embed\/([a-zA-Z0-9_-]{11})/, /shorts\/([a-zA-Z0-9_-]{11})/];
    for (const p of patterns) { const m = s.match(p); if (m && m[1]) return m[1]; }
    return "";
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
  }
  function openOverlay(id){ document.getElementById(id).style.display = "flex"; }
  function closeOverlay(id){
    document.getElementById(id).style.display = "none";
    if (id === "playerOverlay") document.getElementById("playerFrame").src = "";
  }
  ["playerOverlay","loginOverlay","addOverlay"].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener("click", (e)=> { if (e.target === el) closeOverlay(id); });
  });

  function getCategories(){
    const set = new Set(videos.map(v => (v.category||"").trim()).filter(Boolean));
    return ["All", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
  }

  function filterVideos(){
    const q = (document.getElementById("searchInput").value || "").trim().toLowerCase();
    let list = [...videos];
    if (activeCategory !== "All") {
      list = list.filter(v => (v.category||"").toLowerCase() === activeCategory.toLowerCase());
    }
    if (q) {
      list = list.filter(v =>
        (v.title||"").toLowerCase().includes(q) ||
        (v.desc||"").toLowerCase().includes(q) ||
        (v.category||"").toLowerCase().includes(q)
      );
    }
    list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
    return list;
  }

  // =========================
  // Render
  // =========================
  function renderChips(){
    const chips = document.getElementById("chips");
    chips.innerHTML = "";
    for (const cat of getCategories()){
      const el = document.createElement("div");
      el.className = "chip" + (cat === activeCategory ? " active" : "");
      el.textContent = cat;
      el.onclick = () => setCategory(cat);
      chips.appendChild(el);
    }
  }

  function renderGrid(){
    const grid = document.getElementById("grid");
    const list = filterVideos();
    document.getElementById("statusLine").textContent = `${list.length} video${list.length===1?"":"s"}`;
    grid.innerHTML = "";
    if (!list.length){
      grid.innerHTML = `<div style="color:var(--muted)">No videos found. (Admin: add one ‚Üí commit videos.json)</div>`;
      return;
    }
    for (const v of list){
      const thumb = v.youtubeId ? `https://img.youtube.com/vi/${v.youtubeId}/hqdefault.jpg` : "";
      const card = document.createElement("div");
      card.className = "videoCard";
      card.innerHTML = `
        <div class="thumb">
          ${thumb ? `<img src="${thumb}" alt="">` : ""}
          <div class="duration">‚ñ∂</div>
        </div>
        <div class="meta">
          <div class="avatar">MV</div>
          <div>
            <h3>${escapeHtml(v.title || "Untitled")}</h3>
            <div class="sub">${escapeHtml(channel.name)} ‚Ä¢ ${escapeHtml(v.category || "Uncategorized")}</div>
            <div class="sub">${new Date(v.createdAt).toLocaleDateString()}</div>
          </div>
        </div>
      `;
      card.onclick = () => openPlayer(v);
      grid.appendChild(card);
    }
  }

  function setCategory(cat){ activeCategory = cat; renderAll(); }
  function renderAll(){ renderChips(); renderGrid(); }

  // =========================
  // Player
  // =========================
  function openPlayer(v){
    if (!v.youtubeId) return alert("Missing YouTube ID.");
    document.getElementById("playerTitle").textContent = v.title || "Watch";
    document.getElementById("playerDesc").textContent = v.desc || "";
    document.getElementById("playerFrame").src = `https://www.youtube.com/embed/${v.youtubeId}`;
    openOverlay("playerOverlay");
  }

  // =========================
  // Admin
  // =========================
  function openAdminLogin(){
    document.getElementById("loginErr").style.display = "none";
    document.getElementById("adminUser").value = "";
    document.getElementById("adminPass").value = "";
    openOverlay("loginOverlay");
  }
  async function submitLogin(){
  const u = document.getElementById("adminUser").value.trim();
  const p = document.getElementById("adminPass").value.trim();

  if (!admin || !admin.username || !admin.passHash){
    alert("Admin config missing in videos.json");
    return;
  }

  const inputHash = await sha256(p);

  if (u !== admin.username || inputHash !== admin.passHash){
    document.getElementById("loginErr").style.display = "block";
    return;
  }

  // success
  closeOverlay("loginOverlay");
  document.getElementById("addErr").style.display = "none";
  document.getElementById("exportBlock").style.display = "none";
  openOverlay("addOverlay");
}

  function addVideoToJson(){
    const link = document.getElementById("vLink").value.trim();
    const title = document.getElementById("vTitle").value.trim();
    const category = document.getElementById("vCategory").value.trim();
    const desc = document.getElementById("vDesc").value.trim();

    if (!link || !category){
      document.getElementById("addErr").style.display = "block";
      document.getElementById("addErr").textContent = "Please provide at least link + category.";
      return;
    }
    const youtubeId = extractYouTubeId(link);
    if (!youtubeId){
      document.getElementById("addErr").style.display = "block";
      document.getElementById("addErr").textContent = "Could not detect YouTube video ID from that link.";
      return;
    }

    // Add to in-memory list
    videos.push({
      id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())),
      title: title || `Video ‚Ä¢ ${category}`,
      youtubeId,
      category,
      desc,
      createdAt: new Date().toISOString()
    });

    // Generate updated JSON for repo
    const updated = { channel, videos };
    const pretty = JSON.stringify(updated, null, 2);

    document.getElementById("exportJson").textContent = pretty;
    document.getElementById("exportBlock").style.display = "block";
    document.getElementById("addErr").style.display = "none";

    // Update UI immediately (even before commit)
    activeCategory = category;
    renderAll();
  }

  function copyExport(){
    const text = document.getElementById("exportJson").textContent;
    navigator.clipboard.writeText(text).then(()=>alert("Copied! Now paste into videos.json and commit."));
  }
  function downloadExport(){
    const text = document.getElementById("exportJson").textContent;
    const blob = new Blob([text], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "videos.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // =========================
  // Load from repo
  // =========================
  async function loadData(){
  try{
    const res = await fetch(`${DATA_URL}?v=${Date.now()}`); // cache-bust
    if (!res.ok) throw new Error("Failed to load videos.json");

    const data = await res.json();

    channel = data.channel || channel;
    videos = Array.isArray(data.videos) ? data.videos : [];
    admin = data.admin || null;   // ‚úÖ ADD THIS LINE

    document.getElementById("brandName").textContent =
      channel.name || "MadhavVideos";
    document.getElementById("introText").textContent =
      channel.intro || "";

    renderAll();
  }catch(e){
    document.getElementById("introText").textContent =
      "Could not load videos.json. Make sure videos.json is in the repo root and valid JSON.";
    renderAll();
  }
}

  document.getElementById("searchInput").addEventListener("input", renderGrid);
  document.getElementById("searchBtn").addEventListener("click", renderGrid);

  loadData();
</script>
</body>
</html>